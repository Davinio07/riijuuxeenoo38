image: maven:3.8.5-openjdk-17

stages:
  - build
  - test
  - deploy # Still need this stage

build_app:
  stage: build
  tags:
    - hva
  script:
    - cd backend
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - backend/target/*.jar

test_app:
  stage: test
  tags:
    - hva
  script:
    - cd backend
    - mvn test -Dspring.datasource.url=jdbc:h2:mem:testdb -Dspring.datasource.driverClassName=org.h2.Driver -Dspring.datasource.username=sa -Dspring.datasource.password=

pages:
  stage: deploy
  tags:
    - hva
  script:
    - echo "Deploying pre-generated Javadoc from docs/javadoc..."
    - mkdir -p public
    - cp -r docs/javadoc/* public/

  artifacts:
    paths:
      - public
    expire_in: 1 week

  # Change this rule to include your current branch for testing
  only:
    - main
    - javadoc # <--- ADDED: Allow this job to run on the 'javadoc' branch for testing