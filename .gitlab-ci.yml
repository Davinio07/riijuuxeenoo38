image: maven:3.8.5-openjdk-17

stages:
  - build
  - test
  - deploy # Still need this stage

build_app:
  stage: build
  tags:
    - hva
  script:
    - cd backend
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - backend/target/*.jar

test_app:
  stage: test
  tags:
    - hva
  script:
    - cd backend
    - mvn test -Dspring.datasource.url=jdbc:h2:mem:testdb -Dspring.datasource.driverClassName=org.h2.Driver -Dspring.datasource.username=sa -Dspring.datasource.password=

pages: # <--- NEW JOB for documentation deployment
  stage: deploy
  tags:
    - hva
  script:
    - echo "Deploying pre-generated Javadoc from docs/javadoc..."
    # 1. Create the required 'public' directory for GitLab Pages
    - mkdir -p public
    # 2. Copy the content of the existing Javadoc folder into 'public'
    #    The documentation files are already at the project root level.
    - cp -r docs/javadoc/* public/ # <--- This line handles the copy

  artifacts:
    paths:
      - public # This folder contains the deployed Javadoc HTML files
    expire_in: 1 week

  # Only run this job when pushing to the main branch
  only:
    - main # Or 'master', depending on your primary branch name